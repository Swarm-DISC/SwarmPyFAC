
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>swarmpyfac.safety &#8212; SwarmPyFAC 0.1.1 documentation</title>
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SwarmPyFAC 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for swarmpyfac.safety</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot; The safe_user module provides basic security for login information.</span>

<span class="sd">This module is used to save login credentials safely in an encrypted file</span>
<span class="sd">and still have it employed by through an API,</span>
<span class="sd">with possibility for user prompting for password to open said file.</span>

<span class="sd">It uses AES encryption with random initial vector saved in file,</span>
<span class="sd">with the message containing padding if it is short,</span>
<span class="sd">typically less than 4096 characters.</span>
<span class="sd">No guarentee is granted on the strength of the randomization.</span>
<span class="sd">There is given no certification on the security level of data </span>
<span class="sd">stored by the use of this module, so it is mainly recommended </span>
<span class="sd">to be used for data requiring only lower level security,</span>
<span class="sd">such as access to unimportant/semi-public websites.</span>
<span class="sd">If you need high secrutity storage, such as for credit card</span>
<span class="sd">information or state or trade secrets, it is hightly suggested</span>
<span class="sd">you consult a security proffesional on what would be adequat.</span>

<span class="sd">Guide</span>
<span class="sd">-----</span>
<span class="sd">This module is a functional library, with an onion-like abstraction structure.</span>
<span class="sd">There are in general functions to add and remove single layers,</span>
<span class="sd">or add or remove all they way up to a specific layer.</span>
<span class="sd">You can use this to provide a solution on the level you need.</span>

<span class="sd">Each layer has their own section, so you can go look at that,</span>
<span class="sd">for information on that specific layer.</span>
<span class="sd">The layers are: XML, Padding, Encryption, Boxing, Locking.</span>
<span class="sd">There is also a section called Other, which is on parts of the module,</span>
<span class="sd">which falls outside the specific layers.</span>

<span class="sd">XML</span>
<span class="sd">---</span>
<span class="sd">This is the base structure used for communicating data.</span>
<span class="sd">This can be considered the core of the onion,</span>
<span class="sd">and most of functions can work with other data structures.</span>
<span class="sd">The exceptions are fetch_login, and those with XML in their name.</span>
<span class="sd">    </span>
<span class="sd">Functions on this layer:</span>
<span class="sd">    build_default_XML</span>
<span class="sd">        Build a minimal XML structure.</span>
<span class="sd">    find_login_in_XML</span>
<span class="sd">        Extract login information from the XML structure.</span>
<span class="sd">        </span>
<span class="sd">Padding</span>
<span class="sd">-------</span>
<span class="sd">When we add the padding layer we extend a text,</span>
<span class="sd">such that it is a valid input for the encryption layer.</span>
<span class="sd">We also use it to ensure that messages are not short,</span>
<span class="sd">and provide extra entropy.</span>
<span class="sd">The padding layer contains the meta-data needed to undo the padding.</span>
<span class="sd">A message which has this layer applied to it is called</span>
<span class="sd">a padded message/text or padded for short.</span>

<span class="sd">The format used is as follows:</span>
<span class="sd">&#39;Hxxx*paddedMessage              &#39;</span>
<span class="sd">Where H is a hexadeximal number describing how many extra spaces are placed</span>
<span class="sd">at the end to reach a length divisible by 16.</span>
<span class="sd">The xxx describes how many characters to skip</span>
<span class="sd">between each character in the message, it is terminated by the &#39;*&#39;</span>

<span class="sd">Functions on this layer:</span>
<span class="sd">    format_padding</span>
<span class="sd">        A function that takes a text and formats it into a valid padding.</span>
<span class="sd">        You can use this as a minimal padding scheme.</span>
<span class="sd">    remove_padding</span>
<span class="sd">        Recover the plain text from the padded text.</span>
<span class="sd">    add_padding</span>
<span class="sd">        Use sdefault way to add padding.</span>
<span class="sd">    add_padding1, add_padding2, add_padding3</span>
<span class="sd">        Different implementations of padding.</span>
<span class="sd">    set_padding_defaults</span>
<span class="sd">        Used to change add padding defaults, so one can use a different</span>
<span class="sd">        algorithm or base even when using functions that hide these details.</span>
<span class="sd">    </span>
<span class="sd">Encryption</span>
<span class="sd">----------</span>
<span class="sd">When we add the encryption layer we apply AES encryption on a padded text.</span>
<span class="sd">This requires a block size of 128 bits, which means the padded text</span>
<span class="sd">must effectively have a length divisable by 16 (assuming 8 bit charcters).</span>
<span class="sd">The key used is constructed from cryptographic hashing, </span>
<span class="sd">so it is possible to use arbitary length passwords.</span>
<span class="sd">AES encryption requires an initialization vector (IV),</span>
<span class="sd">which is assumed to be of 1 block length (128 bits or 16 characters).</span>
<span class="sd">Failure to satisfy these requirements may result in undocumented errors,</span>
<span class="sd">as the layers around this is build to ensure that they are satisfied.</span>
<span class="sd">A message which has this layer applied to it is called</span>
<span class="sd">eitger an encrypted message/text or cipher text or cipher for short.</span>

<span class="sd">Functions on this layer:</span>
<span class="sd">    encrypt</span>
<span class="sd">        applies the encryption layer to a padded text.</span>
<span class="sd">    decrypt</span>
<span class="sd">        removes the rencryption layer and recover a padded text.</span>

<span class="sd">Boxing</span>
<span class="sd">------</span>
<span class="sd">The boxing layer is concerned with creating a package</span>
<span class="sd">of an encrypted message and its initialization vector.</span>
<span class="sd">The boxing layer only comes in the form where it applies</span>
<span class="sd">multiple layers at once, and it is intended as a simple</span>
<span class="sd">to use outer interface, where you do not need to concern</span>
<span class="sd">yourself with more than what message you have,</span>
<span class="sd">and what password to encrypt it with.</span>
<span class="sd">This means that both the padding layer and encryption</span>
<span class="sd">layer are also applied together with the boxing layer.</span>
<span class="sd">A message which has this layer applied to it is called a boxed message/text.</span>

<span class="sd">Functions in this layer:</span>
<span class="sd">    box_content</span>
<span class="sd">        Take a message (before padding layer),</span>
<span class="sd">        and apply layers with the boxing layer as the outermost layer.</span>
<span class="sd">    unbox_content</span>
<span class="sd">        Take a boxed message and remove,</span>
<span class="sd">        where the innermost layer removed is the padding layer.</span>

<span class="sd">Locking</span>
<span class="sd">-------</span>
<span class="sd">The locking layer is the use of file abstraction,</span>
<span class="sd">where the content of those files may have been boxed on unboxed.</span>
<span class="sd">Just like the boxing layer it is intended as a finishing layer,</span>
<span class="sd">where instead of being applied to strings like the boxing layer,</span>
<span class="sd">it is applied to files instead.</span>
<span class="sd">A file which has this layer applied to it is called</span>
<span class="sd">a locked file or an encrypted file.</span>

<span class="sd">Functions in this layer:</span>
<span class="sd">    lock_file</span>
<span class="sd">        Take a file with some content, and overwrite it with</span>
<span class="sd">        a version of it itself where its content have been boxed.</span>
<span class="sd">    unlock_file</span>
<span class="sd">        Take a file with some boxed content, and overwrite it with</span>
<span class="sd">        a version of it itself where its content have been unboxed.</span>
<span class="sd">    fetch_login</span>
<span class="sd">        Look into a file with boxed xml based content,</span>
<span class="sd">        unbox the content and return information from the file.</span>
<span class="sd">        All without changing the file.</span>
<span class="sd">    build_file</span>
<span class="sd">        Construct xml content similar to build_default_XML,</span>
<span class="sd">        and write a locked file with that content.</span>
<span class="sd">        </span>
<span class="sd">Other</span>
<span class="sd">-----</span>
<span class="sd">_chain</span>
<span class="sd">    A function used to fcreater flatter generators.</span>
<span class="sd">prompt_login_data</span>
<span class="sd">    A function used to prompt username and password from a user at runtime.</span>
<span class="sd">prompt_password</span>
<span class="sd">    A function used to prompt password from a user at runtime.</span>
<span class="sd">    </span>
<span class="sd">Examples</span>
<span class="sd">--------</span>
<span class="sd">&gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">&gt;&gt;&gt; c = box_content(&#39;One Ring to rule them all, &#39;</span>
<span class="sd">...                 &#39;One ring to find them; &#39;</span>
<span class="sd">...                 &#39;One ring to bring them all &#39;</span>
<span class="sd">...                 &#39;and in the darkness bind them.&#39;, password=&#39;Tolkien&#39;)</span>
<span class="sd">&gt;&gt;&gt; len(c)</span>
<span class="sd">3456</span>
<span class="sd">&gt;&gt;&gt; s = unbox_content(c,password=&#39;Tolkien&#39;)</span>
<span class="sd">&gt;&gt;&gt; s[:26]</span>
<span class="sd">&#39;One Ring to rule them all,&#39;</span>

<span class="sd">&gt;&gt;&gt; build_file(&#39;test.xml&#39;,</span>
<span class="sd">...             password=&#39;bukke bruse&#39;, </span>
<span class="sd">...             default_login=(&#39;user1&#39;,&#39;failed&#39;))  # doctest: +SKIP</span>
<span class="sd">&gt;&gt;&gt; fetch_login(&#39;test.xml&#39;, password=&#39;bukke bruse&#39;)  # doctest: +SKIP</span>
<span class="sd">{&#39;username&#39;: &#39;user1&#39;, &#39;password&#39;: &#39;failed&#39;)</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="n">__version__</span> <span class="o">=</span> <span class="s1">&#39;0.4.0&#39;</span>
<span class="n">__author__</span> <span class="o">=</span> <span class="s1">&#39;Ask Neve Gamby&#39;</span>

<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">import</span> <span class="nn">os.path</span>

<span class="kn">import</span> <span class="nn">hashlib</span>
<span class="kn">import</span> <span class="nn">getpass</span>
<span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="k">as</span> <span class="nn">ET</span>
<span class="kn">from</span> <span class="nn">Crypto.Cipher</span> <span class="k">import</span> <span class="n">AES</span>


<span class="k">def</span> <span class="nf">_chain</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
        <span class="k">yield from</span> <span class="n">arg</span>


<div class="viewcode-block" id="prompt_login_data"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.prompt_login_data">[docs]</a><span class="k">def</span> <span class="nf">prompt_login_data</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Prompt a username and a password from the user.</span>
<span class="sd">    </span>
<span class="sd">    This function prompts the user two times,</span>
<span class="sd">    first for a username, secondly for a password.</span>
<span class="sd">    The password prompt hides the input from view,</span>
<span class="sd">    such that one can enter it </span>
<span class="sd">    while others might be looking at the screen.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    A tuple containing the following:</span>
<span class="sd">    user : str</span>
<span class="sd">        A string corrinsponding to the entered username.</span>
<span class="sd">    pw : str</span>
<span class="sd">        A string corrinsponding to the entered password.</span>
<span class="sd">        </span>
<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    The input from the user is not sanity-checked,</span>
<span class="sd">    so it can form a popential vurnerability in deployed software.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; prompt_login_data() # doctest: +ELLIPSIS, +SKIP</span>
<span class="sd">    Enter login username:...</span>
<span class="sd">    Enter login password:...</span>
<span class="sd">    (&#39;...&#39;, &#39;...&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Prompts the user for username and password,</span>
    <span class="c1"># and returns them.</span>
    <span class="c1"># Note that the password is typed in hidden.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s1">&#39;Enter login username:&#39;</span><span class="p">)</span>
    <span class="n">pw</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s1">&#39;Enter login password:&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">pw</span><span class="p">)</span></div>


<div class="viewcode-block" id="prompt_password"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.prompt_password">[docs]</a><span class="k">def</span> <span class="nf">prompt_password</span><span class="p">(</span><span class="n">default</span><span class="o">=</span><span class="s1">&#39;Def8lttPa88word&#39;</span><span class="p">,</span>
                    <span class="n">is_bad</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Prompts the user for a password.</span>
<span class="sd">    </span>
<span class="sd">    This function prompts the user once for a password.</span>
<span class="sd">    The password prompt hides the input from view,</span>
<span class="sd">    such that one can enter it </span>
<span class="sd">    while others might be looking at the screen.</span>
<span class="sd">    </span>
<span class="sd">    This function also allows some sanity checking of the</span>
<span class="sd">    input password, and will replace the password with</span>
<span class="sd">    a default if the users input fails the sanity check.</span>
<span class="sd">    </span>
<span class="sd">    Note that this function is intended to be for passwords,</span>
<span class="sd">    that represent the encryption keys to a file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    default : str</span>
<span class="sd">        A default password to use if the password given</span>
<span class="sd">        by the user does not pass the sanitycheck.</span>
<span class="sd">    is_bad : str -&gt; boolean</span>
<span class="sd">        A function that takes a string (specifically a</span>
<span class="sd">        password candidate) and sanity chekcs it.</span>
<span class="sd">        Note that this function must return True</span>
<span class="sd">        if the candidate is to be discarded, and False</span>
<span class="sd">        if the candidate can be accepted.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        The password given by the user or the default password,</span>
<span class="sd">        if the password given by the user does not pass the sanity check.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; prompt_password() # doctest: +ELLIPSIS, +SKIP</span>
<span class="sd">    Enter password for file: ...</span>
<span class="sd">    ...</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Prompts the user for a password.</span>
    <span class="c1"># If the password is unsatisfactory it is replaced with a default.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">getpass</span><span class="o">.</span><span class="n">getpass</span><span class="p">(</span><span class="s1">&#39;Enter password for file: &#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_bad</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">default</span>
    <span class="k">return</span> <span class="n">password</span></div>
    
    
<div class="viewcode-block" id="format_padding"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.format_padding">[docs]</a><span class="k">def</span> <span class="nf">format_padding</span><span class="p">(</span><span class="n">text</span><span class="p">,</span><span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Formats a message in relation with padding and its metadata.</span>
<span class="sd">    </span>
<span class="sd">    Format a message such that it includes the meta</span>
<span class="sd">    needed to remove the padding.</span>
<span class="sd">    It also may add whitespace at the end to ensure it can be AES encrypted.</span>
<span class="sd">    This function is sufficient for use of the encrypt function.</span>
<span class="sd">    </span>
<span class="sd">    The format looks as follows:</span>
<span class="sd">    &#39;Hxxx*message    &#39;</span>
<span class="sd">    H is a single hexadeximal digit, counting how many spaces</span>
<span class="sd">    have been added at the end.</span>
<span class="sd">    xxx is some digits representing stride in decimal character notation.</span>
<span class="sd">    There amount of digits in xxx is not fixed.</span>
<span class="sd">    The * specify when the xxx digits end and when the text starts.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        A string containing the message.</span>
<span class="sd">    stride : int, optional</span>
<span class="sd">        An integer describing the stride used for where in the text</span>
<span class="sd">        that the actual message can be located.</span>
<span class="sd">        Defaults to 1.</span>
<span class="sd">    *args</span>
<span class="sd">        Extra positional arguments, which are discared.</span>
<span class="sd">        This is here so it can be called with extra positional arguments.</span>
<span class="sd">    **kwargs</span>
<span class="sd">        Extra keyword arguments, which are discared.</span>
<span class="sd">        This is here so it can be called with extra keyword arguments.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string with meta-data. It satisfies len(s) % 16 == 0.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; format_padding(&#39;&#39;)</span>
<span class="sd">    &#39;d0*             &#39;</span>
<span class="sd">    &gt;&gt;&gt; format_padding(&#39;short message&#39;)</span>
<span class="sd">    &#39;00*short message&#39;</span>
<span class="sd">    &gt;&gt;&gt; format_padding(&#39;secret message&#39;)</span>
<span class="sd">    &#39;f0*secret message               &#39;</span>
<span class="sd">    &gt;&gt;&gt; format_padding(&#39;DsReLcnrieBtJ 0mxeRsmsuaQgOe&#39;,2)</span>
<span class="sd">    &#39;11*DsReLcnrieBtJ 0mxeRsmsuaQgOe &#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># prefix = [&#39;0&#39;,str(stride),&#39;*&#39;]</span>
    <span class="c1"># if length is None:</span>
        <span class="c1"># length = len(text) + sum(map(len,prefix))</span>
        
    <span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">stride</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;*&#39;</span> <span class="o">+</span> <span class="n">text</span> <span class="c1">#we record skips instead of stride</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">16</span><span class="p">))</span> <span class="o">%</span> <span class="mi">16</span>
    <span class="k">return</span> <span class="nb">hex</span><span class="p">(</span><span class="n">extra</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">text</span> <span class="o">+</span> <span class="s1">&#39; &#39;</span><span class="o">*</span><span class="n">extra</span></div>
    

    
<div class="viewcode-block" id="add_padding1"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.add_padding1">[docs]</a><span class="k">def</span> <span class="nf">add_padding1</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds padding to the text so it fits well into encryption blocks.</span>
<span class="sd">    </span>
<span class="sd">    This function adds padding to a text, and include some metadata,</span>
<span class="sd">    which can be used to identify which parts are the padding,</span>
<span class="sd">    and thereby remove it.</span>
<span class="sd">    This function may add up to two types of padding,</span>
<span class="sd">    in addition to metadata that may also be added.</span>
<span class="sd">    The first padding type is a randomized padding that spreads</span>
<span class="sd">    out the input text to ensure that the text is not too short,</span>
<span class="sd">    and to provide resistance against length based attacks.</span>
<span class="sd">    The second padding type is blank padding used make the text</span>
<span class="sd">    compatible with block ciphers.</span>
<span class="sd">    This function is hardcoded to align to blocks of length 16.</span>
<span class="sd">    </span>
<span class="sd">    Warning</span>
<span class="sd">    -------</span>
<span class="sd">    This function has been depreciated, you should use add_padding2</span>
<span class="sd">    instead, since this one suffers performance problems.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The text that is to be padded.</span>
<span class="sd">    base : int, optional</span>
<span class="sd">        An integer describing the boundary between short and long texts,</span>
<span class="sd">        where only short texts may be subject to the first type of padding.</span>
<span class="sd">        Default is 4096, must be at least 1.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string based on text, which has length % 16 == 0.</span>
<span class="sd">        It also contains the information needed to remove the padding.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; add_padding1(&#39;secret message&#39;) # doctest: +ELLIPSIS</span>
<span class="sd">    &#39;b255*...s...e...c...r...e...t... ...m...e...s...s...a...g...e           &#39;</span>
<span class="sd">    &gt;&gt;&gt; add_padding1(&#39;secret message&#39;,16) # doctest: +ELLIPSIS</span>
<span class="sd">    &#39;f0*secret message               &#39;</span>
<span class="sd">    &gt;&gt;&gt; add_padding1(&#39;secret message&#39;,8) # doctest: +ELLIPSIS</span>
<span class="sd">    &#39;f0*secret message               &#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Adds enough padding to ensure it can easily be encrypted.</span>
    <span class="c1"># It also add random signal if the text is much shorter</span>
    <span class="c1"># than the base.</span>
    <span class="c1"># Warning: This function is not assymtothically inefficient</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">padded</span> <span class="o">=</span> <span class="n">text</span>
    <span class="n">applications</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">base</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">padded</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="n">applications</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span><span class="o">&lt;&lt;</span><span class="mi">1</span> <span class="o">&lt;=</span> <span class="n">base</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">base</span><span class="p">))</span> <span class="o">-</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">applications</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">temp</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span>
                <span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span>
                <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
                <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">,</span>
                <span class="n">k</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">padded</span><span class="p">))</span>
            <span class="n">padded</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">k</span> <span class="o">+</span> <span class="n">c</span> <span class="k">for</span> <span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">padded</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">format_padding</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">applications</span><span class="p">)</span></div>
    <span class="c1"># padded = str(1 &lt;&lt; applications) + &#39;*&#39; + padded</span>
    <span class="c1"># extra = (16 - ((len(padded) + 1) % 16)) % 16</span>
    <span class="c1"># padded = hex(extra)[2] + padded + &#39; &#39;*extra</span>
    <span class="c1"># return padded</span>
    

<div class="viewcode-block" id="add_padding2"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.add_padding2">[docs]</a><span class="k">def</span> <span class="nf">add_padding2</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds padding to the text so it fits well into encryption blocks.</span>
<span class="sd">    </span>
<span class="sd">    This function adds padding to a text, and include some metadata,</span>
<span class="sd">    which can be used to identify which parts are the padding,</span>
<span class="sd">    and thereby remove it.</span>
<span class="sd">    This function may add up to two types of padding,</span>
<span class="sd">    in addition to metadata that may also be added.</span>
<span class="sd">    The first padding type is a randomized padding that spreads</span>
<span class="sd">    out the input text to ensure that the text is not too short,</span>
<span class="sd">    and to provide resistance against length based attacks.</span>
<span class="sd">    The second padding type is blank padding used make the text</span>
<span class="sd">    compatible with block ciphers.</span>
<span class="sd">    This function is hardcoded to align to blocks of length 16.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        The text that is to be padded.</span>
<span class="sd">    base : int, optional</span>
<span class="sd">        An integer describing the boundary between short and long texts,</span>
<span class="sd">        where only short texts may be subject to the first type of padding.</span>
<span class="sd">        Default is 4096, must be at least 1.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string based on text, which has length % 16 == 0.</span>
<span class="sd">        It also contains the information needed to remove the padding.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; add_padding2(&#39;secret message&#39;) # doctest: +ELLIPSIS</span>
<span class="sd">    &#39;b255*...s...e...c...r...e...t... ...m...e...s...s...a...g...e           &#39;</span>
<span class="sd">    &gt;&gt;&gt; add_padding2(&#39;secret message&#39;,16) # doctest: +ELLIPSIS</span>
<span class="sd">    &#39;f0*secret message               &#39;</span>
<span class="sd">    &gt;&gt;&gt; add_padding2(&#39;secret message&#39;,8) # doctest: +ELLIPSIS</span>
<span class="sd">    &#39;f0*secret message               &#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Adds enough padding to ensure it can easily be encrypted.</span>
    <span class="c1"># It also add random signal if the text is much shorter</span>
    <span class="c1"># than the base.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">padded</span> <span class="o">=</span> <span class="n">text</span>
    <span class="c1"># applications = 0</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">base</span><span class="p">:</span>
        <span class="n">applications</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">base</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="mi">1</span><span class="p">)))</span>
        <span class="c1"># print(applications,1&lt;&lt;applications,base)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">padded</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span>
            <span class="c1"># stride = 1&lt;&lt;(applications+1) </span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">applications</span> <span class="o">&gt;</span> <span class="n">base</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">base</span><span class="p">))</span><span class="o">-</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">applications</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># print(&#39;applications: &#39; + str(applications) + &#39; -&gt; &#39; + str(applications-1))</span>
            <span class="n">applications</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">stride</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">applications</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span>
                   <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
                   <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
        <span class="n">rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">SystemRandom</span><span class="p">()</span>
        <span class="c1"># print( applications, (1 &lt;&lt; applications), (1 &lt;&lt; applications) - 1)</span>
        <span class="n">padded</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_chain</span><span class="p">(</span><span class="n">_chain</span><span class="p">(</span>
            <span class="n">rand</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">applications</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">char</span><span class="p">,))</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="n">padded</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stride</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">format_padding</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span><span class="n">stride</span> <span class="k">if</span> <span class="n">text</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span></div>
    <span class="c1"># padded = str(1 &lt;&lt; applications) + &#39;*&#39; + padded</span>
    <span class="c1"># extra = (16 - ((len(padded) + 1) % 16)) % 16</span>
    <span class="c1"># # print(extra)</span>
    <span class="c1"># padded = hex(extra)[2] + padded + &#39; &#39;*extra</span>
    <span class="c1"># return padded</span>

    
<div class="viewcode-block" id="add_padding3"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.add_padding3">[docs]</a><span class="k">def</span> <span class="nf">add_padding3</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">base</span><span class="o">=</span><span class="mi">4096</span><span class="p">):</span>
    <span class="n">stride</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">base</span><span class="o">/</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">),</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">stride</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">stride</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># print(stride,stride-1)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">base</span><span class="p">:</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">ascii_uppercase</span>
               <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">ascii_lowercase</span>
               <span class="o">+</span> <span class="n">string</span><span class="o">.</span><span class="n">digits</span><span class="p">)</span>
        <span class="n">rand</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">SystemRandom</span><span class="p">()</span>
        <span class="n">padded</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">_chain</span><span class="p">(</span><span class="n">_chain</span><span class="p">(</span>
            <span class="n">rand</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">stride</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="n">char</span><span class="p">,))</span>
            <span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="p">(</span><span class="n">message</span> <span class="k">if</span> <span class="n">message</span> <span class="k">else</span> <span class="s1">&#39; &#39;</span><span class="p">)))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">padded</span> <span class="o">=</span> <span class="n">message</span>
    <span class="k">return</span> <span class="n">format_padding</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span><span class="n">stride</span> <span class="k">if</span> <span class="n">message</span> <span class="k">else</span> <span class="nb">max</span><span class="p">(</span><span class="n">base</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="add_padding"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.add_padding">[docs]</a><span class="k">def</span> <span class="nf">add_padding</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="n">add_padding2</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">algorithm</span><span class="p">(</span><span class="n">message</span><span class="p">,</span><span class="n">base</span><span class="o">=</span><span class="n">base</span><span class="p">)</span></div>
    
    
<div class="viewcode-block" id="set_default_padding"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.set_default_padding">[docs]</a><span class="k">def</span> <span class="nf">set_default_padding</span><span class="p">(</span><span class="n">base</span> <span class="o">=</span> <span class="mi">4096</span><span class="p">,</span> <span class="n">algorithm</span><span class="o">=</span><span class="n">add_padding2</span><span class="p">):</span>
    <span class="n">add_padding</span><span class="o">.</span><span class="vm">__defaults__</span> <span class="o">=</span> <span class="p">(</span><span class="n">base</span><span class="p">,</span><span class="n">algorithm</span><span class="p">)</span></div>
    

<span class="k">def</span> <span class="nf">_split_padding</span><span class="p">(</span><span class="n">padded</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Used for debugging.&quot;&quot;&quot;</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">padded</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>  <span class="c1"># read first character as hexadeximal</span>
    <span class="n">temp</span> <span class="o">=</span> <span class="n">padded</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">extra</span><span class="p">)]</span>
    <span class="n">skip</span><span class="p">,</span> <span class="n">temp</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">stride</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">)]</span>
        <span class="n">rand</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">c</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">c</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">temp</span><span class="p">)</span> <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">temp</span><span class="p">),</span><span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">)))</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">extra</span><span class="p">,</span> <span class="n">stride</span><span class="p">,</span> <span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="n">rand</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">padded</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">extra</span><span class="p">):]]</span>
    
    

<div class="viewcode-block" id="remove_padding"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.remove_padding">[docs]</a><span class="k">def</span> <span class="nf">remove_padding</span><span class="p">(</span><span class="n">padded</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Remove the padding from a string.</span>
<span class="sd">    </span>
<span class="sd">    This function removes the padding generated by an addpadding</span>
<span class="sd">    or the simpler format_padding, including the metadata.</span>
<span class="sd">    The text is assumed to satisfy the format given in format_padding.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    padded : str</span>
<span class="sd">        A piece of text that have been padded by an add_padding.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string of the text without the padding.</span>
<span class="sd">        This should be equivalent to the text before padding was added.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; padded = add_padding(&#39;secret message&#39;)</span>
<span class="sd">    &gt;&gt;&gt; remove_padding(padded)</span>
<span class="sd">    &#39;secret message&#39;</span>
<span class="sd">    &gt;&gt;&gt; remove_padding(add_padding(&#39;other message&#39;,16))</span>
<span class="sd">    &#39;other message&#39;</span>
<span class="sd">    &gt;&gt;&gt; remove_padding(add_padding(&#39;another message&#39;,8))</span>
<span class="sd">    &#39;another message&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># base : int, optional</span>
    <span class="c1"># An integer describing the boundary between short and long texts,</span>
    <span class="c1"># where only short texts may be subject to the first type of padding.</span>
    <span class="c1"># It is important that this is the same as for the call to add_padding2,</span>
    <span class="c1"># as this data is not part of the metadata included in the padding.</span>
    <span class="c1"># Default is 4096, must be at least 1.</span>
    <span class="c1"># There is no guarentee for correct recovery of the message</span>
    <span class="c1"># and removal of padding, if the base used on add_padding2</span>
    <span class="c1"># and remove_padding are different, though for some cases</span>
    <span class="c1"># it will still work (such as if both have len(padded)&gt; base).</span>
    <span class="c1"># &quot;&quot;&quot; removes the padding added by add_padding,</span>
    <span class="c1"># assuming they are done with the same base.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">extra</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">padded</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span>  <span class="c1"># read first character as hexadeximal</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">padded</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span><span class="o">-</span><span class="p">(</span><span class="n">extra</span><span class="p">)]</span>
    <span class="c1"># if len(result) &lt; base:</span>
    <span class="n">skip</span><span class="p">,</span> <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">stride</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">skip</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">::</span><span class="nb">int</span><span class="p">(</span><span class="n">stride</span><span class="p">)]</span>
    <span class="k">return</span> <span class="n">result</span></div>


<div class="viewcode-block" id="encrypt"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.encrypt">[docs]</a><span class="k">def</span> <span class="nf">encrypt</span><span class="p">(</span><span class="n">padded</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">IV</span><span class="o">=</span><span class="mi">16</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="se">\x7A</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Encrypt a text with AES encryption.</span>
<span class="sd">    </span>
<span class="sd">    Encrypts a text with the AES encryption, with given intial vector,</span>
<span class="sd">    and a password either passed or prompted to the user at runtime.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    padded : str</span>
<span class="sd">        A string of (padded) text to be encrypted.</span>
<span class="sd">        It must satisfy len(padded)%16 == 0.</span>
<span class="sd">    password : str, optional</span>
<span class="sd">        The password used to construct the key for the encryption.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">    IV : str, optional</span>
<span class="sd">        A string representing the initial vector of the AES encryption.</span>
<span class="sd">        Must be exactly 16 bytes long (equivalent to 16 normal characters).</span>
<span class="sd">        Default is 16 repeat &#39;\x7A&#39; == &#39;z&#39; letters.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    binary string</span>
<span class="sd">        A binary string containing the encrypted text.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; payload = add_padding(&#39;message&#39;,8)</span>
<span class="sd">    &gt;&gt;&gt; encrypt(payload, password=&#39;ESA&#39;) # doctest: +ELLIPSIS</span>
<span class="sd">    b&#39;...&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Encrypt text with AES encryption,</span>
    <span class="c1"># with given password and InitialVector.</span>
    <span class="c1"># If no password is given the user will be promted for one.</span>
    <span class="c1"># Returns a binary string</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">prompt_password</span><span class="p">()</span>
    <span class="n">hashed</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">hashed</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">IV</span><span class="o">=</span><span class="n">IV</span><span class="p">)</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">padded</span><span class="p">)</span></div>


<div class="viewcode-block" id="decrypt"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.decrypt">[docs]</a><span class="k">def</span> <span class="nf">decrypt</span><span class="p">(</span><span class="n">cipher_text</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">IV</span><span class="o">=</span><span class="mi">16</span> <span class="o">*</span> <span class="s1">&#39;</span><span class="se">\x7A</span><span class="s1">&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Decrypt an AES encrypted message.</span>
<span class="sd">    </span>
<span class="sd">    Decrypts a text with the AES encryption, with given intial vector,</span>
<span class="sd">    and a password either passed or prompted to the user at runtime.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    cipher_text : binary str</span>
<span class="sd">        A string of binary type, which contains an AES encrypted message.</span>
<span class="sd">    password : str, optional</span>
<span class="sd">        The password used to construct the key for the decryption.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">    IV : str, optional</span>
<span class="sd">        A string representing the initial vector of the AES encryption.</span>
<span class="sd">        Must be exactly 16 bytes long (equivalent to 16 normal characters).</span>
<span class="sd">        Default is 16 repeat &#39;\x7A&#39; == &#39;z&#39; letters.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string representing the decrypted text.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; payload = add_padding(&#39;message&#39;,8)</span>
<span class="sd">    &gt;&gt;&gt; cipher_text = encrypt(payload, password=&#39;ESA&#39;) # doctest: +ELLIPSIS</span>
<span class="sd">    &gt;&gt;&gt; decrypt(cipher_text, password=&#39;ESA&#39;) == payload</span>
<span class="sd">    True</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Decrypt text with AES encryption,</span>
    <span class="c1"># with given password and InitialVector.</span>
    <span class="c1"># If no password is given the user will be promted for one.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">password</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">password</span> <span class="o">=</span> <span class="n">prompt_password</span><span class="p">()</span>
    <span class="n">hashed</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">digest</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">AES</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">hashed</span><span class="p">,</span> <span class="n">AES</span><span class="o">.</span><span class="n">MODE_CBC</span><span class="p">,</span> <span class="n">IV</span><span class="o">=</span><span class="n">IV</span><span class="p">)</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">cipher_text</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="find_login_in_XML"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.find_login_in_XML">[docs]</a><span class="k">def</span> <span class="nf">find_login_in_XML</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;viresLogin&#39;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Search an XML string for login-like information.</span>
<span class="sd">    </span>
<span class="sd">    Search a string of xml structure of a specific form.</span>
<span class="sd">    It is assumed that the xml structure contains the following structure:</span>
<span class="sd">    Outermost a root of arbitary tag.</span>
<span class="sd">    Inside the root one or more taged pieces, one being &quot;default&quot;</span>
<span class="sd">    Inside these tags a set of tags with text content.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        A string containing a xml structure as described above.</span>
<span class="sd">    target : str, optional</span>
<span class="sd">        A string describing the tag to search for.</span>
<span class="sd">        Searches for &#39;default&#39; if not found.</span>
<span class="sd">        Defaults to &#39;viresLogin&#39;.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary containing the pairs of tags and text,</span>
<span class="sd">        for tags found as children to the search result.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; find_login_in_XML(&#39;&lt;xml&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;default&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;admin&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;123&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/default&gt;&#39;</span>
<span class="sd">    ...                   &#39;&lt;/xml&gt;&#39;)</span>
<span class="sd">    {&#39;username&#39;: &#39;admin&#39;, &#39;password&#39;: &#39;123&#39;}</span>
<span class="sd">    &gt;&gt;&gt; find_login_in_XML(&#39;&lt;xml&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;viresLogin&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;admin&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;123&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/viresLogin&gt;&#39;</span>
<span class="sd">    ...                   &#39;&lt;/xml&gt;&#39;)</span>
<span class="sd">    {&#39;username&#39;: &#39;admin&#39;, &#39;password&#39;: &#39;123&#39;}</span>
<span class="sd">    &gt;&gt;&gt; find_login_in_XML(&#39;&lt;xml&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;default&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;admin&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;123&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/default&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;viresLogin&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;John&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;Doe&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/viresLogin&gt;&#39;</span>
<span class="sd">    ...                   &#39;&lt;/xml&gt;&#39;)</span>
<span class="sd">    {&#39;username&#39;: &#39;John&#39;, &#39;password&#39;: &#39;Doe&#39;}</span>
<span class="sd">    &gt;&gt;&gt; find_login_in_XML(&#39;&lt;xml&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;default&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;admin&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;123&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/default&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;viresLogin&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;John&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;Doe&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/viresLogin&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;trouble&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;snowflake&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;unique&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/trouble&gt;&#39;</span>
<span class="sd">    ...                   &#39;&lt;/xml&gt;&#39;,</span>
<span class="sd">    ...                   &#39;trouble&#39;)</span>
<span class="sd">    {&#39;username&#39;: &#39;snowflake&#39;, &#39;password&#39;: &#39;unique&#39;}</span>
<span class="sd">    &gt;&gt;&gt; find_login_in_XML(&#39;&lt;xml&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;default&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;admin&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;123&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/default&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;viresLogin&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;John&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;Doe&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/viresLogin&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;trouble&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;username&gt;snowflake&lt;/username&gt;&#39;</span>
<span class="sd">    ...                   &#39;    &lt;password&gt;unique&lt;/password&gt;&#39;</span>
<span class="sd">    ...                   &#39;  &lt;/trouble&gt;&#39;</span>
<span class="sd">    ...                   &#39;&lt;/xml&gt;&#39;,</span>
<span class="sd">    ...                   &#39;globus&#39;)</span>
<span class="sd">    {&#39;username&#39;: &#39;admin&#39;, &#39;password&#39;: &#39;123&#39;}</span>
<span class="sd">    </span>
<span class="sd">    Note</span>
<span class="sd">    ----</span>
<span class="sd">    Using build_file will generate a valid xml structure,</span>
<span class="sd">    containing only the default tag and subtags.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; This will find the login information under target</span>
    <span class="c1"># in the given xml text.</span>
    <span class="c1"># If target is not found, then default may be used instead.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">place</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">place</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">place</span> <span class="o">=</span> <span class="n">root</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;default&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">{</span><span class="n">elem</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span> <span class="n">elem</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">place</span><span class="p">}</span></div>
    

<div class="viewcode-block" id="build_default_XML"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.build_default_XML">[docs]</a><span class="k">def</span> <span class="nf">build_default_XML</span><span class="p">(</span><span class="n">default_login</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Build a xml based string with default login settings.</span>
<span class="sd">    </span>
<span class="sd">    This function creates a string of XML, which contains</span>
<span class="sd">    default login settings, which can then be read</span>
<span class="sd">    by find_login_in_XML or saved to a file.</span>
<span class="sd">    It is recommened to have this information encrypted,</span>
<span class="sd">    such as by using box_content on it.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    default_login : tuple of two strings, optional</span>
<span class="sd">        A tuple of form (username, password), which is used</span>
<span class="sd">        as the default login informaion recorded in the xml string.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string representing an xml file, which contains</span>
<span class="sd">        default login settings and would work for `find_login_in_XML`.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; build_default_XML((&#39;nimda&#39;, &#39;tapas&#39;)) # doctest: +ELLIPSIS</span>
<span class="sd">    &#39;&lt;?xml version=&quot;1.0&quot;?&gt;...&lt;xml&gt;...&lt;default&gt;...&lt;username&gt;nimda&lt;/username&gt;...&lt;password&gt;tapas&lt;/password&gt;...&lt;/default&gt;...&lt;/xml&gt;...&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">default_login</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="o">=</span> <span class="n">prompt_login_data</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="p">(</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span> <span class="o">=</span> <span class="n">default_login</span>
    <span class="n">content</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="s2">&lt;xml&gt;</span>
<span class="s2">    &lt;default&gt;</span>
<span class="s2">        &lt;username&gt;&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;&lt;/username&gt;</span>
<span class="s2">        &lt;password&gt;&quot;&quot;&quot;</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="s2">&quot;&quot;&quot;&lt;/password&gt;</span>
<span class="s2">    &lt;/default&gt;</span>
<span class="s2">&lt;/xml&gt;</span>
<span class="s2">&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">content</span>  <span class="c1"># Easier to see where the function ends this way.</span></div>


<div class="viewcode-block" id="box_content"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.box_content">[docs]</a><span class="k">def</span> <span class="nf">box_content</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Package text into encrypted cypther-text with meta-data.</span>
<span class="sd">    </span>
<span class="sd">    This function &#39;box&#39; the text as an AES encrympted dump.</span>
<span class="sd">    It takes care of all the needed substeps, including</span>
<span class="sd">    padding, choosing initial vector, encryption, and storing meta-data.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    text : str</span>
<span class="sd">        A string of plain text.</span>
<span class="sd">    password : str, optional</span>
<span class="sd">        The password used to construct the key for the encryption.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A binary string containing the encrypted text, initial vector,</span>
<span class="sd">        and other meta-data which is hidden under the encryption.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; box_content(&#39;There is no cake&#39;, &#39;beware of goats&#39;) # doctest: +ELLIPSIS</span>
<span class="sd">    b&#39;...&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; The text is &#39;boxed&#39; as a encrypted dump.</span>
    <span class="c1"># boxing includes padding the message and including</span>
    <span class="c1"># the meta-data needed to undo the process.</span>
    <span class="c1"># If password is not given the user will be prompted for one.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">IV</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">hexdigits</span><span class="p">))</span> <span class="k">for</span> <span class="n">__</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">16</span><span class="p">))</span>
    <span class="n">boxed</span> <span class="o">=</span> <span class="n">encrypt</span><span class="p">(</span><span class="n">add_padding</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">password</span><span class="p">,</span> <span class="n">IV</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">IV</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">boxed</span></div>


<div class="viewcode-block" id="unbox_content"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.unbox_content">[docs]</a><span class="k">def</span> <span class="nf">unbox_content</span><span class="p">(</span><span class="n">boxed</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Retrive text from cyper-text from box_content.</span>
<span class="sd">    </span>
<span class="sd">    This function takes some text that have been &#39;boxed&#39;</span>
<span class="sd">    as an AES encrypted dump, and revert back into the original test.</span>
<span class="sd">    It takes care of all the needed substeps, including</span>
<span class="sd">    removing padding, extracting meta-data and decryption.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    boxed : str</span>
<span class="sd">        A string of binary text, representing a result from box_content.</span>
<span class="sd">    password : str, optional</span>
<span class="sd">        The password used to construct the key for the decryption.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">    </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    str</span>
<span class="sd">        A string representing the decrypted and unpadded text.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; cipher = box_content(&#39;send the rover&#39;, &#39;once in a blue moon&#39;)</span>
<span class="sd">    &gt;&gt;&gt; unbox_content(cipher, &#39;once in a blue moon&#39;)</span>
<span class="sd">    &#39;send the rover&#39;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Retrive the content of a &#39;boxed&#39; text.</span>
    <span class="c1"># This is functionally the inverse of box_content.</span>
    <span class="c1"># If password is not given the user will be prompted for one.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">decrypted</span> <span class="o">=</span> <span class="n">decrypt</span><span class="p">(</span><span class="n">boxed</span><span class="p">[</span><span class="mi">16</span><span class="p">:],</span> <span class="n">password</span><span class="p">,</span> <span class="n">boxed</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">16</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">remove_padding</span><span class="p">(</span><span class="n">decrypted</span><span class="p">)</span></div>


<div class="viewcode-block" id="lock_file"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.lock_file">[docs]</a><span class="k">def</span> <span class="nf">lock_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Replace a file with a boxed version of its content.</span>
<span class="sd">    </span>
<span class="sd">    This function reads the file at the path `filename`,</span>
<span class="sd">    box the content and write the result back over the file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        A string of the path to the file, including its name.</span>
<span class="sd">    password : str, option</span>
<span class="sd">        The password used to construct the key for the encryption.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        There is no return statement, this results in a None.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; lock_file(&#39;some.xml&#39;,&#39;gatekeeper&#39;) # doctest: +SKIP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Replace a file of filename with</span>
    <span class="c1"># the boxed version of its content.</span>
    <span class="c1"># If password is not given the user will be prompted for one.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">box_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>


<div class="viewcode-block" id="build_file"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.build_file">[docs]</a><span class="k">def</span> <span class="nf">build_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">default_login</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Construct a locked xml file which include a default loging.</span>
<span class="sd">    </span>
<span class="sd">    This function is used to construct a defaulted boxed xml file.</span>
<span class="sd">    This can be used with fetch_loging, or unboxed with unlock file.</span>
<span class="sd">    The content of the file, after unboxing can be used with</span>
<span class="sd">    find_login_in_XML.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        A string of the path to the file, including its name.</span>
<span class="sd">    password : str, optional</span>
<span class="sd">        The password used to construct the key for the encryption.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">    default_login : tuple of two strings, optional</span>
<span class="sd">        A tuple of form (username, password), which is used</span>
<span class="sd">        as the default login informaion recorded in the xml file.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        There is no return statement, this results in a None.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; build_file(&#39;example.xml&#39;, &#39;welcome&#39;, (&#39;blank&#39;, &#39;stare&#39;)) # doctest: +SKIP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="sd">&quot;&quot;&quot; Construct a boxed (encrypted with metadata) file</span>
<span class="sd">    of filename, the content will include default login</span>
<span class="sd">    information, which the user will be prompted for.</span>
<span class="sd">    If password for the file is not given the user will be prompted for one.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># if default_login is None:</span>
        <span class="c1"># (user, password) = prompt_login_data()</span>
    <span class="c1"># else:</span>
        <span class="c1"># (user, password) = default_login</span>
    <span class="c1"># content = &quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;</span>
<span class="c1"># &lt;xml&gt;</span>
    <span class="c1"># &lt;default&gt;</span>
        <span class="c1"># &lt;username&gt;&quot;&quot;&quot; + user + &quot;&quot;&quot;&lt;/username&gt;</span>
        <span class="c1"># &lt;password&gt;&quot;&quot;&quot; + password + &quot;&quot;&quot;&lt;/password&gt;</span>
    <span class="c1"># &lt;/default&gt;</span>
<span class="c1"># &lt;/xml&gt;</span>
<span class="c1"># &quot;&quot;&quot;</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">box_content</span><span class="p">(</span><span class="n">build_default_XML</span><span class="p">(</span><span class="n">default_login</span><span class="p">))</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>


<div class="viewcode-block" id="fetch_login"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.fetch_login">[docs]</a><span class="k">def</span> <span class="nf">fetch_login</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="s1">&#39;viresLogin&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Fetch information from a locked file.</span>
<span class="sd">    </span>
<span class="sd">    This function peaks into an encrypted file and retrievs</span>
<span class="sd">    login like information from it, without leaving the file unencrypted.</span>
<span class="sd">    Specifically it uses files that have been locked,</span>
<span class="sd">    meaning it has boxed content.</span>
<span class="sd">    It is assumed that the content after unboxing will form a valid</span>
<span class="sd">    xml structure, that find_login_in_XML can be applied to.</span>
<span class="sd">    </span>
<span class="sd">    This function is intended to be used as a top level abstraction,</span>
<span class="sd">    of aquiring login information in other modules.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        A string of the path to the file, including its name.</span>
<span class="sd">    target : str, optional</span>
<span class="sd">        A string representing the xml tag where the data</span>
<span class="sd">        we want is stored under.</span>
<span class="sd">        If this tag does not exists we will get the data stored</span>
<span class="sd">        uder the tag &#39;default&#39; instead.</span>
<span class="sd">        Default is &#39;viresLogin&#39;.</span>
<span class="sd">    password : str, optional</span>
<span class="sd">        The password used to construct the key for the decryption.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        There is no return statement, this results in a None.</span>
<span class="sd">    </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; fetch_login(&#39;example.xml&#39;, &#39;welcome&#39;) # doctest: +SKIP</span>
<span class="sd">    {&#39;username&#39;: &#39;blank&#39;, &#39;password&#39;: &#39;stare&#39;}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Peek into an encrypted file of filename,</span>
    <span class="c1"># and extract login information on the given target (with default).</span>
    <span class="c1"># If password for the file is not given the user will be prompted for one.</span>
    <span class="c1"># If the file does not exist then a valid file may be constructed</span>
    <span class="c1"># based on input from the user.</span>

    <span class="c1"># Note that this is the main functionally expected to be used outside,</span>
    <span class="c1"># since it can buildup the necessary structure</span>
    <span class="c1"># by just including this function,</span>
    <span class="c1"># and not manually having to set up the rest.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The target file: &#39;</span> <span class="o">+</span> <span class="n">filename</span>
              <span class="o">+</span> <span class="s1">&#39; do not exist yet, constructing it now...&#39;</span><span class="p">)</span>
        <span class="n">build_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">find_login_in_XML</span><span class="p">(</span><span class="n">unbox_content</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">password</span><span class="p">),</span> <span class="n">target</span><span class="p">)</span></div>


<div class="viewcode-block" id="unlock_file"><a class="viewcode-back" href="../../reference.html#swarmpyfac.safety.unlock_file">[docs]</a><span class="k">def</span> <span class="nf">unlock_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Replace a file with an unboxed version of its content.</span>

<span class="sd">    This function reads the file at the path `filename`,</span>
<span class="sd">    unbox the content and write the result back over the file.</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    filename : str</span>
<span class="sd">        A string of the path to the file, including its name.</span>
<span class="sd">    password : str, option</span>
<span class="sd">        The password used to construct the key for the decryption.</span>
<span class="sd">        If it is not specified as a parameter,</span>
<span class="sd">        then the user will be prompted to choose one during runtime.</span>
<span class="sd">        </span>
<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    None</span>
<span class="sd">        There is no return statement, this results in a None.</span>
<span class="sd">        </span>
<span class="sd">    Examples</span>
<span class="sd">    --------</span>
<span class="sd">    &gt;&gt;&gt; from pyfac.safety import *  # doctest: +SKIP</span>
<span class="sd">    &gt;&gt;&gt; unlock_file(&#39;some.xml&#39;,&#39;gatekeeper&#39;) # doctest: +SKIP</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># &quot;&quot;&quot; Replace a file of filename with</span>
    <span class="c1"># the unboxed version of its content.</span>
    <span class="c1"># If password is not given the user will be prompted for one.</span>
    <span class="c1"># &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">unbox_content</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="c1"># Test docstrings</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">SwarmPyFAC 0.1.1 documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019, Ask Neve Gamby.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.8.4.
    </div>
  </body>
</html>